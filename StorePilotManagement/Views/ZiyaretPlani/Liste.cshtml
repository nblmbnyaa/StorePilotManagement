@using StorePilotManagement.ViewModels
@model List<ZiyaretViewModel>
@{
    var filtre = ViewBag.Filtre as ZiyaretFiltreViewModel;
}

@if (TempData["BasariMesaji"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["BasariMesaji"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (TempData["HataMesaji"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["HataMesaji"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<h2>Ziyaret Planları Listesi</h2>

<form method="get" class="row mb-3">
    <div class="col-md-2">
        <label>İlk Tarih</label>
        <input type="date" name="IlkTarih" class="form-control" value="@filtre.IlkTarih.ToString("yyyy-MM-dd")" />
    </div>
    <div class="col-md-2">
        <label>Son Tarih</label>
        <input type="date" name="SonTarih" class="form-control" value="@filtre.SonTarih.ToString("yyyy-MM-dd")" />
    </div>
    <div class="col-md-2">
        <label>Mağaza</label>
        <input type="text" name="MagazaAdi" class="form-control" value="@filtre.MagazaAdi" />
    </div>
    <div class="col-md-3">
        <label>Bölgeler</label>
        <select name="SecilenBolgeler" multiple class="form-control">
            @foreach (var b in filtre.TumBolgeler)
            {
                <option value="@b.Value" selected="@filtre.SecilenBolgeler.Contains(Guid.Parse(b.Value))">@b.Text</option>
            }
        </select>
    </div>
    <div class="col-md-3">
        <label>Durum</label>
        <select name="SecilenDurumlar" multiple class="form-control">
            @foreach (var d in filtre.TumDurumlar)
            {
                <option value="@d.Value" selected="@filtre.SecilenDurumlar.Contains(int.Parse(d.Value))">@d.Text</option>
            }
        </select>
    </div>
    <div class="col-md-12 mt-2">
        <button class="btn btn-primary">Filtrele</button>
    </div>
</form>

<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Tarih</th>
            <th>Mağaza</th>
            <th>Bölge</th>
            <th>Kullanıcı</th>
            <th>Detay</th>
            <th>Durumu</th>
            <th style="width:150px">İşlemler</th>

        </tr>
    </thead>
    <tbody>
        @foreach (var z in Model)
        {
            <tr>
                <td>@z.Tarih.ToString("dd.MM.yyyy")</td>
                <td>@z.MagazaAdi</td>
                <td>@z.BolgeAdi</td>
                <td>@z.KullaniciAdi</td>
                <td>@z.Detay</td>
                <td>@z.DurumuText</td>
                <td>
                    <a asp-action="Duzenle" asp-route-uuid="@z.Uuid" class="btn btn-sm btn-warning me-2">Düzenle</a>
            </tr>
        }
    </tbody>
</table>

<a asp-action="Ekle" class="btn btn-primary mb-3">Yeni Ziyaret Planla</a>

@section Scripts {
    <script>
        setTimeout(() => {
            document.querySelectorAll('.alert').forEach(alert => {
                bootstrap.Alert.getOrCreateInstance(alert).close();
            });
        }, 4000);
    </script>
}
